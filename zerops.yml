# Service hostname to which the application will be deployed.
app:
  build:
    base: [nodejs@18]
    build:
      - npm i
      - git clone https://github.com/twentyhq/twenty.git
      - |
        cd twenty
        yarn
        yarn nx build twenty-front
        cp -r ./packages/twenty-front/build/* ../public
    cache: [node_modules]
    deploy: [index-app.js, node_modules, package.json, public]
  run:
    start: npm start
# Service hostname to which the application will be deployed.
api:
  build:
    base: [nodejs@18]
    build:
      - npm i
      - git clone https://github.com/twentyhq/twenty.git
      - |
        cd twenty
        yarn
        yarn nx build twenty-server
        cp -r ./packages/twenty-server/dist/* ../dist
      - |
        cd twenty/packages/twenty-server
        npx ts-node ./scripts/setup-db.ts
        yarn typeorm:migrate
        yarn command workspace:seed:dev
    cache: [node_modules]
    deploy: [./twenty/packages/twenty-server/~/node-modules/ dist]
  run:
    start: node dist/src/main